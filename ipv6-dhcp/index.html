<!DOCTYPE html>
<html lang="en-US">
<head>
  <script src="https://circuitlover.com/theme.min.js" integrity="sha384-IpIaa84kOKgkF5EJ0fD/kBe2wtIIsIB60ANGmuJxeA0dz5bSRfwBwp2/QybtQpU2"></script>
  <link rel="stylesheet" href="https://circuitlover.com/abridge-switcher.css?h=f1bdbc9aa7de801df19fa0e5893632ad2f5323b2ba8c76a9bc46190b52408029" />
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <script defer src="https://circuitlover.com/search_index.en.js?h=08379b6e70912d6089b216425f6587864f20d818f4724d08697e0d72b90ac933" integrity="sha384-aH+oQjvaesjCKRXoqhS2AwxchQBwQ/vzJ9lo+8ffdGXyXMywFWdu64jOSMXih97+"></script>
  <script defer src="https://circuitlover.com/abridge-bundle-nofacade.min.js?h=9bcf621a2fcab7336017de3cc731a77109758d7d13284046b1403b0c26ade193" integrity="sha384-u8AROOUG6n2Xjk2+7pvkkfeSIqinjI1tmqeBpZRlZtc5KFO/8DyFfEir6fAE2wcq"></script>
  <meta name="base" content="https://circuitlover.com" />
  <link rel="alternate" type="application/atom+xml" title="Atom/RSS Feed" href="https://circuitlover.com/atom.xml" />
  <meta name="robots" content="index, follow" />
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <title>IPv6 and DHCP | CircuitLover</title>
  <meta name="author" content="Tuyen D. Le" />
  <meta name="copyright" content="CircuitLover" />
  <meta name="description" content="Internet Protocol version 6 and Dynamic Host Configuration Protocol (DHCP)" />
  <link rel="canonical" href="https://circuitlover.com/ipv6-dhcp/" />
  <meta name="keywords" content="Abridge, Abridge.css, Zola, Theme, Zola Theme, getzola, Semantic Html, Fast, lightweight" />
  <meta property="og:url" content="https://circuitlover.com/ipv6-dhcp/" />
  <meta name="twitter:url" content="https://circuitlover.com/ipv6-dhcp/" />
  <meta property="og:description" content="Internet Protocol version 6 and Dynamic Host Configuration Protocol (DHCP)" />
  <meta name="twitter:description" content="Internet Protocol version 6 and Dynamic Host Configuration Protocol (DHCP)" />
  <meta property="og:title" content="IPv6 and DHCP | CircuitLover" />
  <meta name="twitter:title" content="IPv6 and DHCP | CircuitLover" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://circuitlover.com/banner.png" />
  <meta property="og:image" content="https://circuitlover.com/banner.png" />
  <meta property="og:site_name" content="CircuitLover" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:updated_time" content="2023-08-30" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#333333" />
  <meta name="msapplication-TileColor" content="#333333" />
  <link rel="manifest" href="https://circuitlover.com/site.webmanifest" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://circuitlover.com/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://circuitlover.com/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://circuitlover.com/favicon-16x16.png" />
  <noscript><link rel="stylesheet" href="https://circuitlover.com/nojs.css" /></noscript>
</head>
<body>
  <header>
    <nav>
      <div><h1><a href="https://circuitlover.com/"><font color="#f90">Circuit</font>Lover</a></h1></div>
      <div>
        <ul><li> <h2><a href="https://circuitlover.com/about/">About</a></h2> </li><li> <h2><a href="https://circuitlover.com/posts/">Posts</a></h2> </li><li> <h2><a href="https://circuitlover.com/categories/">Categories</a></h2> </li><li> <h2><a href="https://circuitlover.com/tags/">Tags</a></h2> </li><li class="js"><i type="reset" id="mode" class="svgs adjust"></i></li></ul>
      </div>
      <div>
        <form autocomplete=off class="js" name="goSearch" id="searchbox">
          <div class="searchd">
            <input id="searchinput" type="text" placeholder="Search" title="Search" />
            <button type="submit" title="Search"><i class="svgs search"></i></button>
          </div>
          <div><div id="suggestions"></div></div>
        </form>
      </div>
    </nav>
    <div>Can&#x27;t stop questioning!</div>
    <hr />
  </header>
  <main>
    <article>
        <h1><a href="https://circuitlover.com/ipv6-dhcp/">IPv6 and DHCP</a></h1>
        <span class="s95"> Tuyen D. Le<span class="hpad"> </span> August 30, 2023<span class="hpad"> </span> [<a href="https://circuitlover.com/categories/server/">Server</a>] #<a href="https://circuitlover.com/tags/dhcp-ipv6/">dhcp, ipv6</a> </span>

    <h2 id="ipv6"><a class="zola-anchor" href="#ipv6" aria-label="Anchor link for: ipv6">IPv6</a></h2>
<h3 id="redirect-ipv6"><a class="zola-anchor" href="#redirect-ipv6" aria-label="Anchor link for: redirect-ipv6">Redirect IPv6</a></h3>
<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++"><span class="z-comment z-block z-c"><span class="z-punctuation z-definition z-comment z-c">/*</span>
  +-------------+         +------------+
  |             |   3     |            |
  |             |---------|            |
  |   R1        |         |    R2      |
  |             |         |            |
  +-------------+         +------------+
          ---                /
            2\----         -/ 4
                  \--     /
              +-------------+
              |             |
              |             |
              |   Switch    |
              |             |
              |             |
            --+-------------+-
          -/                  \-                          -
        -/  1               5   \-
      -/               +------------+
+------------+         |            |
|            |         |            |
|            |         |            |
|   PC1      |         |   PC2      |
|            |         |            |
+------------+         +------------+
 <span class="z-punctuation z-definition z-comment z-c">*/</span></span>
</span></code></pre>
<ul>
<li>Normal scenario: 1-&gt;2-&gt;3-&gt;4-&gt;5</li>
<li>Redirect IPv4: 1-&gt;4-&gt;5</li>
<li>Redirect IPv6: 1-&gt;5</li>
</ul>
<p><strong>Tunnel vs NAT64</strong>
<img src="https://circuitlover.com/ipv6-dhcp/images/tunnel-vs-NAT64.svg" alt="tunnel-vs-NAT64" /></p>
<h3 id="dhcpv6"><a class="zola-anchor" href="#dhcpv6" aria-label="Anchor link for: dhcpv6">DHCPv6</a></h3>
<ul>
<li>DHCPv6 runs basically in 4 steps (SARR)
<ul>
<li>Solict -&gt; Advertise -&gt; Request -&gt; Reply</li>
</ul>
</li>
<li>Router Advertise contains information about Prefix Length and Prefix address</li>
<li>Configure ISC DHCPv6 server on Centos
<ul>
<li>The <code>prefix-length</code> in the PD message sent by the server depends on the <code>prefix-len</code> that the client sends in the DHCPv6 Solicit message</li>
<li>If the client request prefix is different from the one configured on the server, the PD will return <code>Not available</code></li>
</ul>
</li>
<li>Configure DHCPv6 server running on Cisco IOS
<ul>
<li>Ignore <code>prefix-length</code> sent by the client --&gt; returns the PD configured on the server.</li>
</ul>
</li>
<li>Notice the difference between the two messages: Router Adv (RA) and DHCPv6 Adv (although both are Advertise).</li>
<li>Rapid commit:
<ul>
<li>Advertise -&gt; Reply now</li>
<li>The DHCPv6 server's Reply message must have a <code>rapid-commit</code> field (the DHCPv6 Jagonet server does not have this field)</li>
</ul>
</li>
</ul>
<h2 id="dhcp"><a class="zola-anchor" href="#dhcp" aria-label="Anchor link for: dhcp">DHCP</a></h2>
<ul>
<li>DHCP works basically in 4 steps: Discover-Offer-Request-ACK (abbreviated as DORA for easy remembering)
<ul>
<li>DHCP Discover gives the options that the client wants to get.</li>
<li>DHCP Offer is based on the options requested by the client and the options it is configured to respond to to the client.</li>
</ul>
</li>
</ul>
<p>DHCP uses ARP to determine if that IP address is already in use by a host.</p>
<ul>
<li>In the BSD Redhat library, all system calls call the <code>sosend</code> function</li>
<li>DHCP Server differentiates to grant IP to CPE, CM, eMTA based on
<ul>
<li>option 60 <code>vendor-class-identifier</code> in DHCP Discover message</li>
<li>docsis -&gt; CM; pktc -&gt; MTA; eRouter -&gt; CPE</li>
</ul>
</li>
</ul>
<p><strong>For DOCSIS DHCP server:</strong> </p>
<ul>
<li>DHCP Offer and DHCP ACK need to have some specific fields (see more <a rel="noopener" target="_blank" href="https://volpefirm.com/wp-content/uploads/2017/01/CM-SP-MULPIv3.1-I10-170111.pdf">CM-SP-MULPIv3.1</a>)
<ul>
<li><code>yiaddr</code>: your IP address</li>
<li>IP of TFTP server</li>
<li>Config file name on TFTP server</li>
</ul>
</li>
<li>CMTS relies on X/Y downstream/upstream channel to determine which DHCP request is coming from CM or CPE then change the Gateway IP address <code>GIADDR</code></li>
</ul>
<p><strong>Notes:</strong></p>
<ul>
<li><code>file name</code> located in the header is <strong>boot file name</strong></li>
<li>option <code>file name</code>: located in the option <em>option 67</em> - suboption.</li>
</ul>
<h3 id="dhcp-relay-agent"><a class="zola-anchor" href="#dhcp-relay-agent" aria-label="Anchor link for: dhcp-relay-agent">DHCP Relay agent</a></h3>
<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++"><span class="z-comment z-block z-c"><span class="z-punctuation z-definition z-comment z-c">/*</span>
                     ┌──────────────┐
                     │  DHCP Server │
     ┌─────────┐     │              │
     │ Router  ├─────┴──────────────┘
     │    R1   │
     └─┬────┬──┘
       │    │
┌──────┤    ├───────┐
│      │    │  PC2  │
│  PC1 │    │       │
└──────┘    └───────┘
 <span class="z-punctuation z-definition z-comment z-c">*/</span></span>
</span></code></pre>
<ul>
<li>In this mode Router R1 does not directly assign IPs to PC1 and PC2, but it will forward this DHCP message to the dedicated DHCP Server.</li>
<li>PC1 and PC2 do not need to know the address of the DHCP Server.</li>
<li><code>255.255.255.255</code> is a broadcast message from the client, if the Router is not configured as a Relay Agent, it will discard this message.
<ul>
<li>Discover-Request messages have the same <code>transaction ID</code></li>
<li>The Request-ACK message has the same <code>transaction ID</code></li>
</ul>
</li>
<li>Time Release is the Rebinding time when Renew fails.
<ul>
<li>Default: Renew 30s; Rebinding 60s</li>
</ul>
</li>
</ul>

<p><b><a href="#">Back to top</a></b></p>
    </article>
    <div class="toc" aria-hidden="true">
      <div class="toc-sticky">
        <h3>Index</h3>
        <div class="toc-item">
          <a class="subtext" href="https://circuitlover.com/ipv6-dhcp/#ipv6">IPv6</a>
        </div>
        <div class="toc-item-child">
          <a class="subtext" href="https://circuitlover.com/ipv6-dhcp/#redirect-ipv6"><small>- Redirect IPv6</small></a>
        </div>
        <div class="toc-item-child">
          <a class="subtext" href="https://circuitlover.com/ipv6-dhcp/#dhcpv6"><small>- DHCPv6</small></a>
        </div>
        <div class="toc-item">
          <a class="subtext" href="https://circuitlover.com/ipv6-dhcp/#dhcp">DHCP</a>
        </div>
        <div class="toc-item-child">
          <a class="subtext" href="https://circuitlover.com/ipv6-dhcp/#dhcp-relay-agent"><small>- DHCP Relay agent</small></a>
        </div>
      </div>
    </div>
  </main>
  <footer>
    <hr />
    <div class="c">
      <nav>
        <ul><li><a href="https://circuitlover.com/atom.xml" target="_blank" title="Atom/RSS Feed"><i type="Button" class="svg rss" title="Atom/RSS Feed"></i></a></li><li class="js"><a class="m-protected" href="#dHV5ZW5sZEBjaXJjdWl0bG92ZXIuY29t" target="_blank" title="Mail"><i type="Button" class="svg mail" title="Mail"></i></a></li><li><a href="https://www.linkedin.com/in/tuyendl/" target="_blank" title="LinkedIn"><i type="Button" class="svg linkedin" title="LinkedIn"></i></a></li><li><a href="https://github.com/tuyenld/" target="_blank" title="Github"><i type="Button" class="svg github" title="Github"></i></a></li></ul>
      </nav>
      <p class="s90">Copyright &copy; 2023 CircuitLover</p>
      <nav>
        <ul><li class="s90"> <a href="https://circuitlover.com/about/"> About </a> </li><li class="s90"> <a href="https://circuitlover.com/contact/"> Contact </a> </li><li class="s90"> <a href="https://circuitlover.com/privacy/"> Privacy </a> </li><li class="s90"> <a href="https://circuitlover.com/sitemap.xml" target="_blank"> Sitemap </a> </li></ul>
      </nav>
      <p class="s90">Powered by <a href="https://www.getzola.org/" target="_blank">Zola</a> and <a href="https://github.com/jieiku/abridge/" target="_blank">Abridge</a></p>
    </div>
  </footer>
<span class="topout">
<span class="topleft"> </span><a href="#" class="top" title="Back to Top"><i class="svgs svgh angu"></i></a>
</span>
</body>
</html>